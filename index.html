<!DOCTYPE html>
<html>
<head>
  <title>Happy Birthday ğŸ‚</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      text-align: center;
      font-family: Arial;
      background: linear-gradient(#ffd1dc, #ffe5ec);
    }

    h2 {
      margin-top: 15px;
    }

    #start {
      font-size: 16px;
      color: #c2185b;
      margin-top: 10px;
    }

    #puzzle {
      width: 300px;
      height: 300px;
      margin: 20px auto;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2px;
      pointer-events: none;
      opacity: 0.5;
    }

    .piece {
      width: 100px;
      height: 100px;
      background-image: url("photo.jpg");
      background-size: 300px 300px;
      border-radius: 8px;
      cursor: pointer;
      border: 2px solid transparent;
    }

    .selected {
      border: 2px solid #d81b60;
    }

    #msg {
      display: none;
      font-size: 22px;
      color: #c2185b;
      font-weight: bold;
      margin-top: 20px;
    }
  </style>
</head>

<body>

<h2>ğŸ‰ Solve the Birthday Puzzle ğŸ‰</h2>
<div id="start">ğŸ‘‰ Tap once to start the puzzle</div>

<div id="puzzle"></div>

<div id="msg">
  ğŸ‚ Happy Birthday! ğŸ‚<br>
  Wishing you endless happiness â¤ï¸
</div>

<audio id="song" src="song.mp3" preload="auto"></audio>

<script>
  const puzzle = document.getElementById("puzzle");
  const song = document.getElementById("song");
  const msg = document.getElementById("msg");
  const startText = document.getElementById("start");

  let audioUnlocked = false;

  // Unlock audio on first user tap
  document.body.addEventListener("click", () => {
    if (!audioUnlocked) {
      song.play().then(() => {
        song.pause();
        song.currentTime = 0;
        audioUnlocked = true;
        puzzle.style.pointerEvents = "auto";
        puzzle.style.opacity = "1";
        startText.style.display = "none";
      }).catch(() => {});
    }
  }, { once: true });

  let pieces = [...Array(9).keys()];
  pieces.sort(() => Math.random() - 0.5);

  let selected = null;

  pieces.forEach(pos => {
    const div = document.createElement("div");
    div.className = "piece";
    div.dataset.correct = pos;
    div.style.backgroundPosition =
      `-${(pos % 3) * 100}px -${Math.floor(pos / 3) * 100}px`;

    div.onclick = () => {
      if (!selected) {
        selected = div;
        div.classList.add("selected");
      } else if (selected !== div) {
        swap(selected, div);
        selected.classList.remove("selected");
        selected = null;
        checkSolved();
      }
    };

    puzzle.appendChild(div);
  });

  function swap(a, b) {
    const tempPos = a.style.backgroundPosition;
    const tempData = a.dataset.correct;

    a.style.backgroundPosition = b.style.backgroundPosition;
    a.dataset.correct = b.dataset.correct;

    b.style.backgroundPosition = tempPos;
    b.dataset.correct = tempData;
  }

  function checkSolved() {
    const all = document.querySelectorAll(".piece");
    let solved = true;

    all.forEach((piece, index) => {
      if (parseInt(piece.dataset.correct) !== index) {
        solved = false;
      }
    });

    if (solved) {
      song.play();
      msg.style.display = "block";
    }
  }
</script>

</body>
</html>